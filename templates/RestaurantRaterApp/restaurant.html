{% extends 'RestaurantRaterApp/base.html' %}
{% load static %}
{% load restaurant_rater_tags %}

{% block title_block %}
	{% if restaurant %}
		{{ restaurant.name }}
	{% else %}
		Unknown Restaurant
	{% endif %}
{% endblock %}

{% block body_block %}
    {% if restaurant %}
        <div class="col-md-7 p-1-2">

            <!--- name and rating header --->
            <div class="d-grid gap-2 d-flex mb-2 mx-1">
                <div class="col-1 flex-fill">
                    {% include 'RestaurantRaterApp/arrow_or_heart.html' with restaurant=restaurant %}
                </div>
                <div class="col-6 flex-fill">
                    <h1>{{ restaurant.name }}</h1>
                </div>
                <div class="col-5 flex-fill">
                    {% include 'RestaurantRaterApp/stars.html' with rating=restaurant.rating %}
                </div>
            </div>

            <!--- restaurant description --->
            <div class="row justify-content-center align-items-center p-1 me-2">
                <div class="bg-warning p-3">
                    {{ restaurant.description }}
                </div>
            </div>

            <div class="row d-grid d-md-flex gap-3 justify-content-md-around my-3">

                <!--- scrollable images --->
                <div class="col-md-5">
                    <div id="restaurantCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner justify-content-center">
                            <div class="carousel-item active">
                                <div class="d-flex justify-content-center">
                                    <img src="{{ MEDIA_URL}}{{ restaurant.name }}/img1.jpg" class="d-block w-100 rounded" alt="{{ restaurant.name }} image 1">
                                </div>
                            </div>
                            <div class="carousel-item">
                                <div class="d-flex justify-content-center">
                                    <img src="{{ MEDIA_URL}}{{ restaurant.name }}/img2.jpg" class="d-block w-100 rounded" alt="{{ restaurant.name }} image 2">
                                </div>
                            </div>
                            <div class="carousel-item">
                                <div class="d-flex justify-content-center">
                                    <img src="{{ MEDIA_URL}}{{ restaurant.name }}/img3.jpg" class="d-block w-100 rounded" alt="{{ restaurant.name }} image 3">
                                </div>
                            </div>
                      </div>
                      <button class="carousel-control-prev" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      </button>
                      <button class="carousel-control-next" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      </button>
                    </div>
                </div>

                <!--- google maps link --->
                <div class="col-md-5">
                    <iframe
                      width="100%"
                      height="100%"
                      loading="lazy"
                      allowfullscreen
                      src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBbtL7kmjYC2XAWqPz8MpDzz-AYoeEMgi0&q={{ restaurant.map_link }}">
                    </iframe>
                </div>

            </div>

        </div>
        <div class="col-md-5">

            <!--- table of reviews --->
            <div class="row justify-content-center align-items-center">
                {% if restaurant.comments %}
                    <table class="table table-secondary table-hover">
                        <thead>
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">Reviews</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for commenter, review in restaurant.comments.items %}
                                <!-- alternate cyan and yellow rows -->
                                <tr class="{% get_row_colour forloop.counter %}">
                                    <td>{{ commenter }}</td>
                                    <td>{{ review }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <strong>Our records currently don't contain any reviews!</strong><br />
                {% endif %}
            </div>

            <!--- favourite and review buttons --->
            {% if user.is_authenticated %}
                <div class="d-grid gap-2 d-md-flex justify-content-md-around">
                    {% if restaurant %} <!--- TODO: in user.liked_restaurants --->
                        <!--- TODO: remove from favourites --->
                        <a class="btn btn-warning" href="{% url 'RestaurantRaterApp:show_restaurant' restaurant.restaurant_id %}" role="button">Remove from favourites</a>
                    {% else %}
                        <!--- TODO: add to favourites --->
                        <a class="btn btn-warning" href="{% url 'RestaurantRaterApp:show_restaurant' restaurant.restaurant_id %}" role="button">Add to favourites</a>
                    {% endif %}
                    <a class="btn btn-warning" href="{% url 'RestaurantRaterApp:review' restaurant.restaurant_id %}" role="button">Leave a review</a>
                </div>
            {% else %}
                <div class="p-3 text-center">
                    <h5>You'll need to log in or sign up to leave a review!</h5>
                </div>
            {% endif %}

        </div>
	{% else %}
		Sorry, no restaurant recognised
	{% endif %}
{% endblock %}